<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <title>JBTV - Kajian & Artikel Islami</title>

    <meta property="og:title" content="JBTV - Kajian & Artikel Islami" />
    <meta property="og:description" content="Siaran langsung dan info kajian rutin dari JBTV." />
    <meta property="og:image" content="https://i.postimg.cc/L4bXV47w/Thumbnail-Website.png" />
    <meta property="og:url" content="https://jbtv-id.netlify.app" />
    <meta name="twitter:card" content="summary_large_image" />

    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>


    <style>
        /* --- Variabel Warna Global (Root) --- */
        :root {
            --color-bg-white: #ffffff;
            --color-bg-grey: #f7f7f7;
            --color-text: #333;
            --color-primary: #007bff;
            --color-dark: #343a40;
            --color-green: #28a745;
            --color-red: #dc3545;
            --color-blue: #17a2b8;
            --timeline-line-color: #e0e0e0;
        }

        /* --- Gaya Dasar untuk Body, Container, dan Judul --- */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--color-bg-grey);
            color: var(--color-text);
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        h2 {
            font-size: 1.5em;
            text-align: center;
            margin-bottom: 40px;
            color: var(--color-dark);
        }

        /* --- Gaya Latar Belakang Section --- */
        .section-white {
            background-color: var(--color-bg-white);
        }

        .section-grey {
            background-color: #114ed7;
        }

        .section-grey h2,
        .section-grey h4,
        .section-grey p {
            color: white;
        }

        .section-grey h4 {
            color: #d1d1d1;
        }

        /* --- Gaya untuk Pemutar Video Streaming --- */
        .live-streaming-wrapper {
            text-align: center;
        }

        .video-container {
            position: relative;
            width: 100%;
            padding-bottom: 56.25%;
            height: 0;
            overflow: hidden;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 0;
        }

        /* --- Gaya untuk News Ticker (Teks Berjalan) --- */
        .news-ticker {
            display: flex;
            align-items: center;
            background-color: #114ed7;
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            margin: 25px auto;
            overflow: hidden;
            box-shadow: 0 0px 0px rgba(0, 0, 0, 0.3);
            border-top: 0px solid #00008B;
        }

        .news-ticker:hover .streaming-info {
            animation-play-state: paused;
        }

        .ticker-prefix {
            flex-shrink: 0;
            display: flex;
            align-items: center;
            padding-right: 10px;
            margin-right: 10px;
            border-right: 1px solid rgba(255, 255, 255, 0.4);
        }

        .live-indicator .dot {
            width: 8px;
            height: 8px;
            background-color: white;
            border-radius: 50%;
            margin-right: 5px;
            animation: blink 1.5s infinite;
        }

        .date-time-section {
            font-weight: bold;
            font-size: 0.6em;
            text-align: center;
            background-color: var(--color-red);
            padding: 4px 8px;
            border-radius: 3px;
            color: white;
        }

        .date-time-section span {
            display: block;
        }

        #live-time {
            font-size: 1.1em;
        }

        .marquee-section {
            flex-grow: 1;
            overflow: hidden;
        }

        .streaming-info {
            font-size: 0.9em;
            color: white;
            display: inline-block;
            padding-left: 100%;
            white-space: nowrap;
            animation: marquee 20s linear;
            margin: 0;
            vertical-align: middle;
            will-change: transform;
        }

        @keyframes blink {
            50% {
                opacity: 0.3;
            }
        }

        @keyframes marquee {
            0% {
                transform: translateX(0%);
            }

            100% {
                transform: translateX(-100%);
            }
        }

        /* --- Gaya untuk Tombol Aksi (Like, Komen, Share) --- */
        .post-actions {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            border-top: 1px solid #eee;
            border-bottom: 1px solid #eee;
            padding: 10px 0;
            margin-bottom: 20px;
        }

        .action-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1em;
            color: #555;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .action-btn:hover {
            color: var(--color-primary);
        }

        .action-btn i {
            font-size: 1.2em;
        }

        #comments-wrapper {
            display: none;
            margin-top: 20px;
        }

        h4 {
            font-size: 0.8em;
            text-align: center;
            margin-top: -40px;
            color: var(--color-dark);
        }

        /* --- Gaya untuk Timeline Jadwal dan Pengumuman --- */
        .timeline-container {
            width: 100%;
            margin: auto
        }

        .timeline-content {
            display: none;
        }

        .timeline-content.active {
            display: block;
        }

        .timeline {
            position: relative;
            list-style: none;
            padding-left: 40px;
            margin: 0;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 10px;
            top: 0;
            bottom: 0;
            width: 3px;
            background-color: #5d8bf2;
            border-radius: 3px;
        }

        .timeline-item {
            position: relative;
            margin-bottom: 30px;
        }

        .timeline-item::after {
            content: '';
            position: absolute;
            left: -35px;
            top: 5px;
            width: 13px;
            height: 13px;
            background-color: #114ed7;
            border: 3px solid #5d8bf2;
            border-radius: 50%;
            z-index: 1;
        }

        .timeline-item-content {
            background-color: #2a65e0;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #5d8bf2;
        }

        .timeline-tag {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 5px;
            font-size: 0.9em;
            font-weight: 600;
            margin-right: 8px;
            margin-bottom: 10px;
        }

        .tag-dark { background-color: var(--color-dark); color: white; }
        .tag-red { background-color: var(--color-red); color: white; }
        .tag-green { background-color: var(--color-green); color: white; margin-top: 10px; }
        .tag-blue { background-color: var(--color-blue); color: white; }
        .pengumuman-content { display: flex; gap: 20px; align-items: flex-start; }
        .pengumuman-flyer { width: 120px; height: auto; border-radius: 5px; object-fit: cover; box-shadow: #333; }
        .pengumuman-details { flex: 1; }

        @media (max-width: 600px) {
            .pengumuman-content { flex-direction: column; }
            .pengumuman-flyer { width: 100%; max-width: 250px; }
        }

        .timeline-dropdown-wrapper { display: flex; justify-content: center; margin-bottom: 30px; margin-left: auto; margin-right: auto; }
        .custom-dropdown { appearance: none; -webkit-appearance: none; -moz-appearance: none; background-color: #ffffff; color: #333; padding: 12px 12px 12px 12px; font-size: 0.8em; font-weight: 600; border: 2px solid #fff; border-radius: 8px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05); background-image: url('data:image/svg+xml;charset=UTF-8,<svg width="16" height="16" fill="gray" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M1.5 5.5l6 6 6-6" stroke="gray" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>'); background-repeat: no-repeat; background-position: right 12px center; background-size: 16px; transition: border-color 0.3s, box-shadow 0.3s; cursor: pointer; }
        .custom-dropdown:hover { border-color: #ddd; }
        .wa-float-container { position: fixed; bottom: 20px; right: 20px; display: flex; flex-direction: column; gap: 8px; z-index: 9999; align-items: flex-end; }
        .wa-float { display: flex; align-items: center; gap: 8px; padding: 10px 16px; color: #fff; border-radius: 50px; font-weight: bold; text-decoration: none; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2); transition: transform 0.3s ease; font-size: 14px; }
        .wa-float:hover { transform: scale(1.05); }
        .wa-ikhwan { background-color: #25D366; }
        .wa-akhwat { background-color: #128C7E; }
        .wa-label { background-color: #333; color: white; padding: 4px 10px; font-size: 12px; border-radius: 12px; margin-right: 5px; opacity: 0.8; }
        .section-about p { font-size: 0.9em; max-width: 700px; margin: 25px auto; margin-top: -20px; text-align: center; font-style: normal; font-weight: normal; color: #fffff; }
        footer { background-color: var(--color-dark); color: white; text-align: center; padding: 0; font-size: 0.9em; font-style: normal; font-weight: normal; }
        footer .container { padding-top: 20px; padding-bottom: 20px; }
        
        /* --- [DIUBAH] Gaya untuk Layout Grid Artikel dengan Snippet --- */
        #articles-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .article-grid-item {
            background-color: var(--color-bg-white);
            border-radius: 8px;
            text-decoration: none;
            color: var(--color-text);
            display: flex;
            flex-direction: column;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            overflow: hidden; /* Mencegah konten keluar dari border-radius */
        }

        .article-grid-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.1);
        }
        
        .article-grid-content {
            padding: 25px;
            flex-grow: 1; /* Membuat konten mengisi ruang yang tersedia */
            display: flex;
            flex-direction: column;
        }

        .article-grid-item h3 {
            font-size: 1.2em;
            color: #114ed7;
            margin: 0 0 10px 0;
            text-align: left;
        }
        
        .article-grid-snippet {
            font-size: 0.9em;
            color: #555;
            line-height: 1.6;
            margin: 0 0 15px 0;
            flex-grow: 1; /* Memastikan snippet mengisi ruang sebelum tombol */
        }

        .article-grid-footer {
            margin-top: auto; /* Mendorong footer ke bawah */
            padding: 15px 25px;
            background-color: #f9f9f9;
            text-align: right;
            border-top: 1px solid #eee;
        }

        .article-grid-item .read-more-link {
            font-size: 0.9em;
            font-weight: 600;
            color: var(--color-primary);
            text-decoration: none;
        }
        /* --- [AKHIR DIUBAH] --- */

        .ask-question-float { position: fixed; left: 20px; bottom: 20px; right: auto; width: auto; height: auto; padding: 10px 18px; border-radius: 50px; display: flex; align-items: center; gap: 10px; font-size: 15px; font-weight: 500; background-color: var(--color-primary); color: white; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2); cursor: pointer; z-index: 10000; transition: transform 0.3s ease; }
        .ask-question-float:hover { transform: scale(1.1); }
        .modal-backdrop { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.6); z-index: 10001; display: flex; align-items: center; justify-content: center; opacity: 0; visibility: hidden; transition: opacity 0.3s, visibility 0.3s; }
        .modal-backdrop.visible { opacity: 1; visibility: visible; }
        .modal-content { background-color: white; padding: 30px; border-radius: 8px; width: 90%; max-width: 500px; position: relative; transform: scale(0.9); transition: transform 0.3s; }
        .modal-backdrop.visible .modal-content { transform: scale(1); }
        .modal-close-btn { position: absolute; top: 10px; right: 15px; font-size: 28px; color: #aaa; cursor: pointer; border: none; background: none; }
        .modal-content h3 { margin-top: 0; color: #114ed7; display: flex; align-items: center; gap: 10px; }
        .modal-form { display: flex; flex-direction: column; gap: 15px; }
        .modal-form input, .modal-form textarea { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 5px; font-size: 1em; box-sizing: border-box; }
        .modal-form textarea { height: 120px; resize: vertical; }
        .modal-form button { padding: 12px 20px; background-color: #007bff; color: white; border: none; border-radius: 5px; font-size: 1em; cursor: pointer; transition: background-color 0.3s; }
        .modal-form button:hover { background-color: #0056b3; }
    </style>
</head>


<body>

    <section class="section-white">
        <div class="container live-streaming-wrapper">
            <h2></h2>
            <h4></h4>
            <div class="video-container">
                <iframe
                    src="https://www.facebook.com/plugins/video.php?href=https://web.facebook.com/jbtv17/videos/1116523027070382/"
                    frameborder="0" allowfullscreen></iframe>
            </div>

            <div class="news-ticker">
                <div class="ticker-prefix">
                    <div class="date-time-section">
                        <span id="live-time">07:02:08</span>
                    </div>
                </div>
                <div class="marquee-section">
                    <p class="streaming-info"></p>
                </div>
            </div>

            <div>
                <p style="font-size: 0.9em; margin-bottom: -20px;">Klik icon volume pada video jika tidak ada suaranya!
                </p>
            </div>
        </div>

        <div class="post-actions">
            <button class="action-btn" id="viewersBtn" title="Sedang menonton">
                <i class="fa-solid fa-eye"></i>
                <span id="viewersCount">0</span>
            </button>
            <button class="action-btn like-btn" id="likeBtn">
                <i class="fa-solid fa-thumbs-up"></i>
                <span id="likeCount">0</span>
            </button>
            <button class="action-btn" id="commentBtn">
                <i class="fa-solid fa-comment"></i>
                <span id="commentCount">0</span>
            </button>
            <button class="action-btn" id="shareBtn">
                <i class="fa-solid fa-share"></i>
                <span id="shareCount">0</span>
            </button>
        </div>

        <div id="comments-wrapper">
            <section class="section-white">
                <div class="container">
                    <h2 style="font-size: 1.5em; margin-top: -30px;"></h2>
                    <form id="commentForm" style="margin-top: -70px;">
                        <input type="text" id="name" placeholder="Nama Anda" required
                            style="padding: 10px; width: 100%; margin-bottom: 10px; border-radius: 5px; border: 1px solid #ccc;">
                        <textarea id="comment" placeholder="Tulis komentar..." required
                            style="padding: 10px; width: 100%; height: 100px; border-radius: 5px; border: 1px solid #ccc;"></textarea>
                        <button type="submit"
                            style="padding: 10px 20px; background-color: #007bff; color: white; border: none; border-radius: 5px; margin-top: 20px; margin-bottom: 20px;">Kirim
                            Komentar</button>
                    </form>
                    <div id="commentsList"></div>
                </div>
            </section>
        </div>
    </section>
    <section class="section-grey">
        <div class="container">
            <h2><strong>Jadwal Kajian</h2>
            <h4 id="rentangTanggalKajian" style="color: #ffffff; font-style: oblique; font-size: 0.8;">Belum ada tanggal
                kajian</h4>

            <div class="timeline-container">
                <div class="timeline-nav timeline-dropdown-wrapper">
                    <select id="ustadzDropdown" onchange="openDropdownTab(event)" class="custom-dropdown">
                        <option value="ustad1">TGH. Suharni Abdul Manan, Lc.</option>
                        <option value="ustad2">Ust. Zamakhsyari Dhofir, Lc., M.A.</option>
                        <option value="ustad3">Ust. Ahmad Marwazi Manar, S.H., M.A.</option>
                    </select>
                </div>

                <div id="ustad1" class="timeline-content active">
                    <ul class="timeline" id="jadwal-ustad1"></ul>
                </div>
                <div id="ustad2" class="timeline-content">
                    <ul class="timeline" id="jadwal-ustad2"></ul>
                </div>
                <div id="ustad3" class="timeline-content">
                    <ul class="timeline" id="jadwal-ustad3"></ul>
                </div>
            </div>
        </div>
    </section>
    <section class="section-white">
        <div class="container">
            <h2 style="color:  #114ed7;"><strong>Pengumuman</strong></h2>
            <ul class="timeline" id="pengumuman-container"></ul>
        </div>
    </section>
    <section class="section-grey">
        <div class="container">
            <h2 style="color: #ffffff;"><strong>Artikel Islami</strong></h2>
            <div id="articles-container"></div>
        </div>
    </section>
    <section class="section-white section-about">
        <div class="container">
            <h2 style="color: #114ed7;"><strong>Tentang</h2>
            <p>
                <strong>JB TV</strong> adalah saluran media dakwah di bawah naungan Pondok Pesantren Jamaluddin, Bagik
                Nyaka. Tujuan kami adalah menyebarkan ilmu syar'i secara luas dan mudah diakses oleh umat.
            </p>
        </div>
    </section>
    <div class="wa-float-container">
        <div class="wa-label">Group WA</div>
        <a href="https://chat.whatsapp.com/KIDegAern9GF0Z1wzkxoJ2" target="_blank" class="wa-float wa-ikhwan"
            title="Gabung Grup Ikhwan">
            <i class="fab fa-whatsapp"></i> Ikhwan
        </a>
        <a href="https://chat.whatsapp.com/Kmd1of6VpRi9kWxrnNXUdH" target="_blank" class="wa-float wa-akhwat"
            title="Gabung Grup Akhawat">
            <i class="fab fa-whatsapp"></i> Akhwat
        </a>
    </div>

    <div class="ask-question-float" id="ask-question-btn" title="Ajukan Pertanyaan">
        <i class="fa-solid fa-comments"></i>
        <span>Tanya Ustadz</span>
    </div>

    <div class="modal-backdrop" id="questionModal">
        <div class="modal-content">
            <button class="modal-close-btn" id="modalCloseBtn">&times;</button>
            <h3><i class="fa-solid fa-paper-plane"></i> Ajukan Pertanyaan</h3>
            <p style="font-size: 0.8em; color: #555; margin-top: -10px; margin-bottom: 20px;">
                Pertanyaan Anda akan kami sampaikan kepada Ustadz. Jawaban akan dipublikasikan sebagai artikel jika
                relevan.
            </p>
            <form id="questionForm" class="modal-form">
                <input type="text" id="questionName" placeholder="Nama Anda (Boleh disamarkan)" required>
                <textarea id="questionText" placeholder="Tulis pertanyaan Anda di sini..." required></textarea>
                <button type="submit">Kirim Pertanyaan</button>
            </form>
        </div>
    </div>

    <footer>
        <div class="container">
            &copy; 2025 JBTV | By: Muzanni
        </div>
    </footer>
    <script>
        function openDropdownTab(evt) {
            const selectedValue = evt.target.value;
            const tabcontent = document.getElementsByClassName("timeline-content");
            for (let i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            document.getElementById(selectedValue).style.display = "block";
        }

        document.addEventListener("DOMContentLoaded", function () {

            if (document.getElementById("ustadzDropdown")) {
                document.getElementById("ustadzDropdown").value = "ustad1";
                document.getElementById("ustad1").style.display = "block";
            }
            
            const firebaseConfig = {
                apiKey: "AIzaSyAowVtnXTVstFSc3kSBTm5tXJkEvp31V2Y",
                authDomain: "streamingjbtv.firebaseapp.com",
                databaseURL: "https://streamingjbtv-default-rtdb.asia-southeast1.firebasedatabase.app",
                projectId: "streamingjbtv",
                storageBucket: "streamingjbtv.appspot.com",
                messagingSenderId: "191301318558",
                appId: "1:191301318558:web:f32dada7468d8a4486088f",
                measurementId: "G-PBGDKCMQJT"
            };

            firebase.initializeApp(firebaseConfig);
            const db = firebase.database();
            const liveTimeEl = document.getElementById('live-time');
            function updateDateTime() {
                const now = new Date();
                const padZero = (num) => (num < 10 ? '0' + num : num);
                const timeString = `${padZero(now.getHours())}:${padZero(now.getMinutes())}:${padZero(now.getSeconds())} Wita`;
                liveTimeEl.textContent = timeString;
            }
            updateDateTime();
            setInterval(updateDateTime, 1000);

            const streamingInfoEl = document.querySelector('.streaming-info');
            const messages = [
                "Selamat datang di JBTV. Saksikan siaran langsung kajian Islam dan dapatkan informasi jadwal terbaru.",
                "Kami menyediakan siaran langsung dari youtube dan facebook yang bisa anda tonton di sini. Format video streaming memiliki variasi kualitas dan mengikuti kecepatan internet sehingga Anda bisa nyaman dalam menyimak <strong>streaming siaran JBTV.</strong>",
                "Dukung dakwah JBTV dengan donasi terbaik Anda."
            ];
            let currentMessageIndex = 0;

            function runMarquee() {
                streamingInfoEl.innerHTML = messages[currentMessageIndex];
                streamingInfoEl.style.animation = 'none';
                void streamingInfoEl.offsetWidth; 
                streamingInfoEl.style.animation = '';
                streamingInfoEl.style.animationName = 'marquee';
                streamingInfoEl.style.animationIterationCount = '1';
            }
            streamingInfoEl.addEventListener('animationend', () => {
                currentMessageIndex = (currentMessageIndex + 1) % messages.length;
                runMarquee();
            });
            runMarquee();

            const videoIframe = document.querySelector('.video-container iframe');
            if (!videoIframe) {
                console.error("Iframe video tidak ditemukan!");
                return;
            }
            const videoSrc = videoIframe.src;
            const videoId = btoa(videoSrc); 
            const videoInteractionsRef = db.ref('video_interactions/' + videoId);
            const commentsRef = videoInteractionsRef.child('comments');
            const likesRef = videoInteractionsRef.child('likes');
            const sharesRef = videoInteractionsRef.child('shares');
            const presenceRef = videoInteractionsRef.child('presence');
            const viewersCountSpan = document.getElementById('viewersCount');
            const likeBtn = document.getElementById('likeBtn');
            const likeCountSpan = document.getElementById('likeCount');
            const commentBtn = document.getElementById('commentBtn');
            const commentCountSpan = document.getElementById('commentCount');
            const shareBtn = document.getElementById('shareBtn');
            const shareCountSpan = document.getElementById('shareCount');
            const commentsWrapper = document.getElementById('comments-wrapper');
            const form = document.getElementById('commentForm');
            const commentsList = document.getElementById('commentsList');
            const isAdmin = window.location.search.includes('admin=true');

            const amOnline = db.ref('.info/connected');
            amOnline.on('value', (snapshot) => {
                if (snapshot.val()) {
                    const myRef = presenceRef.push();
                    myRef.onDisconnect().remove();
                    myRef.set(true);
                }
            });

            presenceRef.on('value', (snapshot) => {
                viewersCountSpan.textContent = snapshot.numChildren();
            });
            commentBtn.addEventListener('click', () => {
                const isVisible = commentsWrapper.style.display === 'block';
                commentsWrapper.style.display = isVisible ? 'none' : 'block';
            });
            commentsRef.on('value', (snapshot) => {
                commentCountSpan.textContent = snapshot.exists() ? snapshot.numChildren() : 0;
            });
            likeBtn.addEventListener('click', () => {
                likesRef.transaction((currentLikes) => (currentLikes || 0) + 1);
            });
            likesRef.on('value', (snapshot) => {
                likeCountSpan.textContent = snapshot.val() || 0;
            });
            shareBtn.addEventListener('click', async () => {
                const shareData = {
                    title: 'JB TV - Kajian & Artikel Islami',
                    text: 'Saksikan siaran langsung dan lihat baca artikel islami!',
                    url: window.location.href
                };
                const incrementShareCount = () => {
                    sharesRef.transaction((currentShares) => (currentShares || 0) + 1);
                };
                if (navigator.share) { 
                    try {
                        await navigator.share(shareData);
                        incrementShareCount();
                    } catch (err) { console.error('Gagal membagikan:', err); }
                } else { 
                    try {
                        await navigator.clipboard.writeText(window.location.href);
                        alert('Tautan berhasil disalin ke clipboard!');
                        incrementShareCount();
                    } catch (err) { alert('Gagal menyalin link.'); }
                }
            });
            sharesRef.on('value', (snapshot) => {
                shareCountSpan.textContent = snapshot.val() || 0;
            });
            form.addEventListener('submit', function (e) {
                e.preventDefault();
                const name = document.getElementById('name').value.trim();
                const comment = document.getElementById('comment').value.trim();
                if (name && comment) {
                    commentsRef.push({ name, comment, timestamp: Date.now() });
                    form.reset();
                }
            });
            commentsRef.on('child_added', function (snapshot) {
                const data = snapshot.val();
                const key = snapshot.key;
                const el = document.createElement('div');
                el.style.marginBottom = '20px';
                el.id = `comment-${key}`;
                const time = new Date(data.timestamp).toLocaleString('id-ID');
                el.innerHTML = `
                        <div style="padding: 10px; background: #fff; border: 1px solid #ddd; border-radius: 6px; text-align: left;">
                            <strong>${data.name}</strong> <small style="color: gray;">(${time})</small>
                            <p style="margin: 5px 0;">${data.comment}</p>
                            ${isAdmin ? `<button onclick="deleteComment('${key}')">Hapus</button>` : ""}
                        </div>
                    `;
                commentsList.prepend(el);
            });
            window.deleteComment = function (commentKey) {
                if (confirm("Yakin ingin menghapus komentar ini?")) {
                    commentsRef.child(commentKey).remove();
                }
            };
            commentsRef.on('child_removed', function (snapshot) {
                const key = snapshot.key;
                const commentElement = document.getElementById(`comment-${key}`);
                if (commentElement) { commentElement.remove(); }
            });

            const jadwalRef = db.ref('jadwalKajian');
            const pengumumanRef = db.ref('pengumuman');
            const articlesRef = db.ref('articles');
            const tanggalRef = db.ref('infoSitus/rentangTanggal');
            const jadwalUstad1Container = document.getElementById('jadwal-ustad1');
            const jadwalUstad2Container = document.getElementById('jadwal-ustad2');
            const jadwalUstad3Container = document.getElementById('jadwal-ustad3');
            const pengumumanContainer = document.getElementById('pengumuman-container');
            const articlesContainer = document.getElementById('articles-container');
            const rentangTanggalKajianElem = document.getElementById('rentangTanggalKajian');

            tanggalRef.on('value', (snapshot) => {
                if (snapshot.exists()) {
                    rentangTanggalKajianElem.textContent = snapshot.val();
                } else {
                    rentangTanggalKajianElem.textContent = 'Jadwal Kajian Rutin';
                }
            });
            jadwalRef.on('value', (snapshot) => {
                jadwalUstad1Container.innerHTML = '<li>Memuat jadwal...</li>';
                jadwalUstad2Container.innerHTML = '<li>Memuat jadwal...</li>';
                jadwalUstad3Container.innerHTML = '<li>Memuat jadwal...</li>';
                if (snapshot.exists()) {
                    jadwalUstad1Container.innerHTML = '';
                    jadwalUstad2Container.innerHTML = '';
                    jadwalUstad3Container.innerHTML = '';
                    snapshot.forEach((childSnapshot) => {
                        const jadwal = childSnapshot.val();
                        const itemHtml = `<li class="timeline-item"><div class="timeline-item-content"><span class="timeline-tag tag-dark">${jadwal.jenis}</span><span class="timeline-tag tag-red">${jadwal.waktu}</span><div><span class="timeline-tag tag-green">${jadwal.lokasi}</span></div></div></li>`;
                        if (jadwal.ustadzId === 'ustad1') { jadwalUstad1Container.innerHTML += itemHtml; }
                        else if (jadwal.ustadzId === 'ustad2') { jadwalUstad2Container.innerHTML += itemHtml; }
                        else if (jadwal.ustadzId === 'ustad3') { jadwalUstad3Container.innerHTML += itemHtml; }
                    });
                } else {
                    jadwalUstad1Container.innerHTML = '<li style="color: white;">Belum ada jadwal.</li>';
                    jadwalUstad2Container.innerHTML = '<li style="color: white;">Belum ada jadwal.</li>';
                    jadwalUstad3Container.innerHTML = '<li style="color: white;">Belum ada jadwal.</li>';
                }
            });
            pengumumanRef.on('value', (snapshot) => {
                pengumumanContainer.innerHTML = '<li>Memuat pengumuman...</li>';
                if (snapshot.exists()) {
                    pengumumanContainer.innerHTML = '';
                    snapshot.forEach((childSnapshot) => {
                        const pengumuman = childSnapshot.val();
                        const itemHtml = `<li class="timeline-item"><div class="timeline-item-content"><div class="pengumuman-content"><img src="${pengumuman.flyerUrl}" alt="Flyer ${pengumuman.judul}" class="pengumuman-flyer"><div class="pengumuman-details"><span class="timeline-tag tag-dark">${pengumuman.judul}</span><span class="timeline-tag tag-blue">Pemateri: ${pengumuman.pemateri}</span><div><span class="timeline-tag tag-green">${pengumuman.waktu}</span></div><div><span class="timeline-tag tag-red">${pengumuman.lokasi}</span></div></div></div></div></li>`;
                        pengumumanContainer.innerHTML += itemHtml;
                    });
                } else {
                    pengumumanContainer.innerHTML = '<li>Belum ada pengumuman.</li>';
                }
            });

            // --- [DIUBAH] Logika untuk memuat artikel dengan snippet ---
            articlesRef.orderByChild('timestamp').limitToLast(6).on('value', (snapshot) => {
                articlesContainer.innerHTML = '<p style="color:white; grid-column: 1 / -1;">Memuat artikel...</p>';
                if (snapshot.exists()) {
                    articlesContainer.innerHTML = '';
                    const articles = [];
                    snapshot.forEach(child => { articles.push({ key: child.key, ...child.val() }); });
                    articles.reverse().forEach(article => {
                        
                        // 1. Ambil konten HTML dan bersihkan tag-nya untuk membuat teks biasa
                        const tempDiv = document.createElement('div');
                        tempDiv.innerHTML = article.content;
                        const plainTextContent = tempDiv.textContent || tempDiv.innerText || "";
                        
                        // 2. Buat snippet dari teks biasa tersebut
                        const snippet = plainTextContent.substring(0, 100) + (plainTextContent.length > 100 ? '...' : '');

                        // 3. Buat template HTML baru yang menyertakan snippet
                        const articleHtml = `
                            <div class="article-grid-item">
                                <div class="article-grid-content">
                                    <h3>${article.title}</h3>
                                    <p class="article-grid-snippet" style="color: black;">${snippet}</p>
                                </div>
                                <div class="article-grid-footer">
                                    <a href="artikel.html?id=${article.key}" class="read-more-link">
                                        Baca Selengkapnya &rarr;
                                    </a>
                                </div>
                            </div>`;
                        articlesContainer.innerHTML += articleHtml;
                    });
                } else {
                    articlesContainer.innerHTML = '<p style="color:white; grid-column: 1 / -1;">Belum ada artikel yang dipublikasikan.</p>';
                }
            });
            // --- [AKHIR DIUBAH] ---

            const askBtn = document.getElementById('ask-question-btn');
            const modal = document.getElementById('questionModal');
            const closeBtn = document.getElementById('modalCloseBtn');
            const questionForm = document.getElementById('questionForm');
            const questionsRef = db.ref('pertanyaanMasuk');

            askBtn.addEventListener('click', () => modal.classList.add('visible'));
            const closeModal = () => modal.classList.remove('visible');
            closeBtn.addEventListener('click', closeModal);
            modal.addEventListener('click', (e) => { if (e.target === modal) closeModal(); });

            questionForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const name = document.getElementById('questionName').value.trim();
                const question = document.getElementById('questionText').value.trim();
                if (!name || !question) {
                    alert('Nama dan Pertanyaan harus diisi.');
                    return;
                }
                const submitButton = questionForm.querySelector('button[type="submit"]');
                submitButton.disabled = true;
                submitButton.textContent = 'Mengirim...';

                questionsRef.push({ nama: name, pertanyaan: question, timestamp: Date.now(), status: 'baru' })
                    .then(() => {
                        alert('Pertanyaan Anda telah berhasil terkirim. Syukron!');
                        questionForm.reset();
                        closeModal();
                    })
                    .catch((error) => {
                        alert('Maaf, terjadi kesalahan. Silakan coba lagi.');
                    })
                    .finally(() => { 
                        submitButton.disabled = false;
                        submitButton.textContent = 'Kirim Pertanyaan';
                    });
            });
        });
    </script>
</body>

</html>
